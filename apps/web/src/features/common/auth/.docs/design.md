# Auth Feature Design Document

## Overview

SPA JWTæ§‹æˆã®PKCEï¼ˆProof Key for Code Exchangeï¼‰èªè¨¼ã‚’å°å…¥ã—ã€Amazon Cognitoã‚’ä½¿ç”¨ã—ãŸã‚»ã‚­ãƒ¥ã‚¢ãªèªè¨¼ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

## Requirements

### å¿…é ˆè¦ä»¶
- PKCEèªè¨¼ãƒ•ãƒ­ãƒ¼ï¼ˆAuthorization Code Flow with PKCEï¼‰
- Cognito Hosted UIã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
- JWTãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ï¼ˆAccess Token, ID Token, Refresh Tokenï¼‰
- èªè¨¼çŠ¶æ…‹ã®æ°¸ç¶šåŒ–ï¼ˆlocalStorage/sessionStorageï¼‰
- è‡ªå‹•ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½
- èªè¨¼ã‚¬ãƒ¼ãƒ‰ï¼ˆæœªèªè¨¼æ™‚ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¦ä»¶
- Remember Meæ©Ÿèƒ½
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè­¦å‘Š
- ãƒãƒ«ãƒã‚¿ãƒ–åŒæœŸ

## User Stories

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ã€ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦Cognito Hosted UIã§èªè¨¼ã—ãŸã„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ã€èªè¨¼å¾Œã«è‡ªå‹•çš„ã«ã‚¢ãƒ—ãƒªã«æˆ»ã‚ŠãŸã„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚èªè¨¼çŠ¶æ…‹ã‚’ç¶­æŒã—ãŸã„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’çµ‚äº†ã—ãŸã„
- ç®¡ç†è€…ã¨ã—ã¦ã€èªè¨¼ã•ã‚Œã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä¿è­·ã•ã‚ŒãŸãƒšãƒ¼ã‚¸ã‹ã‚‰ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãŸã„

## Non-Goals

- ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆGoogle, Facebookç­‰ï¼‰ã®åˆæœŸå®Ÿè£…
- MFAï¼ˆå¤šè¦ç´ èªè¨¼ï¼‰ã®åˆæœŸå®Ÿè£…
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆãƒ•ãƒ­ãƒ¼ï¼ˆCognito Hosted UIã«å§”è­²ï¼‰

---

## ç”»é¢è¨­è¨ˆ

### 1. ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ (`/login`)

#### ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚                                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚     ğŸ” ãƒ­ã‚´/ã‚¢ã‚¤ã‚³ãƒ³    â”‚                   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚                     â”‚                   â”‚
â”‚                    â”‚   WorkFlow          â”‚                   â”‚
â”‚                    â”‚                     â”‚                   â”‚
â”‚                    â”‚  æ¥­å‹™åŠ¹ç‡åŒ–ã®ãŸã‚ã®    â”‚                   â”‚
â”‚                    â”‚  ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ„ãƒ¼ãƒ«      â”‚                   â”‚
â”‚                    â”‚                     â”‚                   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚                     â”‚                   â”‚
â”‚                    â”‚  â– â– â– â– â– â– â– â– â– â– â– â– â– â– â–    â”‚                   â”‚
â”‚                    â”‚  ãƒ­ã‚°ã‚¤ãƒ³             â”‚                   â”‚
â”‚                    â”‚                     â”‚                   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚  è¨€èªåˆ‡æ›¿            â”‚                   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ãƒ¢ãƒã‚¤ãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆ320px-640pxï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       â”‚
â”‚     ğŸ”                â”‚
â”‚                       â”‚
â”‚   WorkFlow            â”‚
â”‚                       â”‚
â”‚   æ¥­å‹™åŠ¹ç‡åŒ–ã®ãŸã‚ã®    â”‚
â”‚   ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ„ãƒ¼ãƒ«      â”‚
â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 â”‚  â”‚
â”‚  â”‚   ãƒ­ã‚°ã‚¤ãƒ³        â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚
â”‚   ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª â–¼        â”‚
â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ãƒ‡ã‚¶ã‚¤ãƒ³ä»•æ§˜

| è¦ç´  | ãƒ¢ãƒã‚¤ãƒ« | ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ | ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ— |
|------|----------|------------|--------------|
| ã‚³ãƒ³ãƒ†ãƒŠå¹… | 100% (px-4) | max-w-sm | max-w-md |
| ãƒ­ã‚´ã‚µã‚¤ã‚º | 48x48px | 64x64px | 80x80px |
| ã‚¿ã‚¤ãƒˆãƒ« | text-2xl | text-3xl | text-4xl |
| ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ« | text-sm | text-base | text-lg |
| ãƒœã‚¿ãƒ³é«˜ã• | 52px | 52px | 56px |
| ä½™ç™½ | py-8 | py-12 | py-16 |

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°

**ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³**
```svelte
<!-- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãªãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ -->
<Button
  class="
    w-full
    min-h-[52px] sm:min-h-[56px]
    text-base sm:text-lg
    font-semibold
    gap-2
  "
  onclick={handleLogin}
  disabled={isLoading}
>
  {#if isLoading}
    <LoadingSpinner class="w-5 h-5 animate-spin" />
    {$t.auth.loggingIn}
  {:else}
    <LockIcon class="w-5 h-5" />
    {$t.auth.login}
  {/if}
</Button>
```

---

### 2. èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒšãƒ¼ã‚¸ (`/auth/callback`)

#### çŠ¶æ…‹é·ç§»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚    â”‚              â”‚    â”‚              â”‚
â”‚   Loading    â”‚â”€â”€â”€â–ºâ”‚   Success    â”‚â”€â”€â”€â–ºâ”‚   Redirect   â”‚
â”‚   (èªè¨¼å‡¦ç†ä¸­)  â”‚    â”‚   (èªè¨¼æˆåŠŸ)    â”‚    â”‚   (ãƒ›ãƒ¼ãƒ ã¸)   â”‚
â”‚              â”‚    â”‚              â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ ã‚¨ãƒ©ãƒ¼
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚
â”‚    Error     â”‚
â”‚  (ã‚¨ãƒ©ãƒ¼è¡¨ç¤º)   â”‚
â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### LoadingçŠ¶æ…‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚                                                              â”‚
â”‚                                                              â”‚
â”‚                         âŸ³                                   â”‚
â”‚                    (ã‚¹ãƒ”ãƒŠãƒ¼)                                  â”‚
â”‚                                                              â”‚
â”‚                   èªè¨¼å‡¦ç†ä¸­...                                â”‚
â”‚                                                              â”‚
â”‚                                                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ErrorçŠ¶æ…‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚                                                              â”‚
â”‚                         âš ï¸                                  â”‚
â”‚                                                              â”‚
â”‚                   èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ                            â”‚
â”‚                                                              â”‚
â”‚            ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç„¡åŠ¹ã‹ã€æœŸé™åˆ‡ã‚Œã§ã™ã€‚                      â”‚
â”‚            ã‚‚ã†ä¸€åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚                         â”‚
â”‚                                                              â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                  â”‚  ãƒ­ã‚°ã‚¤ãƒ³ã¸æˆ»ã‚‹   â”‚                        â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. èªè¨¼ã‚¬ãƒ¼ãƒ‰ï¼ˆProtected Routesï¼‰

#### æœªèªè¨¼æ™‚ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚    â”‚              â”‚    â”‚              â”‚
â”‚  ä¿è­·ãƒšãƒ¼ã‚¸ã¸   â”‚â”€â”€â”€â–ºâ”‚  èªè¨¼ãƒã‚§ãƒƒã‚¯   â”‚â”€â”€â”€â–ºâ”‚  ãƒ­ã‚°ã‚¤ãƒ³     â”‚
â”‚  ã‚¢ã‚¯ã‚»ã‚¹      â”‚    â”‚              â”‚    â”‚  ãƒšãƒ¼ã‚¸ã¸     â”‚
â”‚              â”‚    â”‚              â”‚    â”‚  ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ èªè¨¼æ¸ˆã¿
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              â”‚
                    â”‚  ãƒšãƒ¼ã‚¸è¡¨ç¤º   â”‚
                    â”‚              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã®çµ±åˆ

èªè¨¼çŠ¶æ…‹ã¯ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ`features/common/header`ï¼‰ã¨é€£æºã—ã¾ã™ã€‚

#### ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—è¡¨ç¤ºï¼ˆèªè¨¼æ¸ˆã¿ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”¶ WorkFlow    [ãƒ›ãƒ¼ãƒ ] [ã‚¿ã‚¹ã‚¯]              ğŸ‘¤ å±±ç”°å¤ªéƒ â–¼ ğŸ‡¯ğŸ‡µ  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                                              â”‚ ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«   â”‚ â”‚
â”‚                                              â”‚ âš™ï¸ è¨­å®š          â”‚ â”‚
â”‚                                              â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚                                              â”‚ ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ     â”‚ â”‚
â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
```

#### ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—è¡¨ç¤ºï¼ˆæœªèªè¨¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”¶ WorkFlow    [ãƒ›ãƒ¼ãƒ ] [ã‚¿ã‚¹ã‚¯]                  [ãƒ­ã‚°ã‚¤ãƒ³] ğŸ‡¯ğŸ‡µ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼å†…ãƒ»èªè¨¼æ¸ˆã¿ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”¶ WorkFlow    [Ã—]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       â”‚
â”‚  ğŸ‘¤ å±±ç”°å¤ªéƒ           â”‚
â”‚  yamada@example.com   â”‚
â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ  ãƒ›ãƒ¼ãƒ              â”‚
â”‚  ğŸ“‹ ã‚¿ã‚¹ã‚¯             â”‚
â”‚  â±ï¸ æ‰“åˆ»              â”‚
â”‚  ğŸ“Š å‹¤æ€               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš™ï¸ è¨­å®š              â”‚
â”‚  ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª â–¼          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼å†…ãƒ»æœªèªè¨¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”¶ WorkFlow    [Ã—]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     ãƒ­ã‚°ã‚¤ãƒ³      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ  ãƒ›ãƒ¼ãƒ              â”‚
â”‚  ğŸ“‹ ã‚¿ã‚¹ã‚¯             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª â–¼          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ãƒ˜ãƒƒãƒ€ãƒ¼çµ±åˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

`UserMenu.svelte` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ `features/common/auth/components/` ã«ä½œæˆã—ã€
ãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ä½¿ç”¨ã—ã¾ã™ã€‚

```typescript
// features/common/header/components/AppHeader.svelte
import { UserMenu } from "@/features/common/auth/components";
import { isAuthenticated } from "@/features/common/auth/store";
```

---

## PKCEèªè¨¼ãƒ•ãƒ­ãƒ¼è©³ç´°

### ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚          â”‚ SPA  â”‚          â”‚ Cognito  â”‚          â”‚  API â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜          â””â”€â”€â”¬â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”¬â”€â”€â”€â”˜
   â”‚                 â”‚                   â”‚                   â”‚
   â”‚ 1. ãƒ­ã‚°ã‚¤ãƒ³ã‚¯ãƒªãƒƒã‚¯ â”‚                   â”‚                   â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚                   â”‚
   â”‚                 â”‚                   â”‚                   â”‚
   â”‚                 â”‚ 2. code_verifierç”Ÿæˆ â”‚                   â”‚
   â”‚                 â”‚    code_challengeè¨ˆç®—â”‚                   â”‚
   â”‚                 â”‚    stateç”Ÿæˆ        â”‚                   â”‚
   â”‚                 â”‚                   â”‚                   â”‚
   â”‚                 â”‚ 3. èªè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ     â”‚                   â”‚
   â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚
   â”‚                 â”‚   (code_challenge, â”‚                   â”‚
   â”‚                 â”‚    state, etc.)    â”‚                   â”‚
   â”‚                 â”‚                   â”‚                   â”‚
   â”‚ 4. Cognito Hosted UIè¡¨ç¤º             â”‚                   â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
   â”‚                 â”‚                   â”‚                   â”‚
   â”‚ 5. ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±å…¥åŠ›  â”‚                   â”‚                   â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚
   â”‚                 â”‚                   â”‚                   â”‚
   â”‚ 6. ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯     â”‚                   â”‚                   â”‚
   â”‚    (/auth/callback?code=xxx&state=yyy)                  â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
   â”‚                 â”‚                   â”‚                   â”‚
   â”‚                 â”‚ 7. stateæ¤œè¨¼       â”‚                   â”‚
   â”‚                 â”‚ 8. ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›      â”‚                   â”‚
   â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚
   â”‚                 â”‚   (code,           â”‚                   â”‚
   â”‚                 â”‚    code_verifier)  â”‚                   â”‚
   â”‚                 â”‚                   â”‚                   â”‚
   â”‚                 â”‚ 9. ãƒˆãƒ¼ã‚¯ãƒ³è¿”å´      â”‚                   â”‚
   â”‚                 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
   â”‚                 â”‚   (access_token,   â”‚                   â”‚
   â”‚                 â”‚    id_token,       â”‚                   â”‚
   â”‚                 â”‚    refresh_token)  â”‚                   â”‚
   â”‚                 â”‚                   â”‚                   â”‚
   â”‚                 â”‚ 10. ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜     â”‚                   â”‚
   â”‚                 â”‚                   â”‚                   â”‚
   â”‚ 11. ãƒ›ãƒ¼ãƒ ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ                  â”‚                   â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                   â”‚
   â”‚                 â”‚                   â”‚                   â”‚
   â”‚                 â”‚ 12. APIå‘¼ã³å‡ºã—     â”‚                   â”‚
   â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                 â”‚   Authorization:   â”‚                   â”‚
   â”‚                 â”‚   Bearer <token>   â”‚                   â”‚
   â”‚                 â”‚                   â”‚                   â”‚
```

---

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

```
apps/web/src/features/common/auth/
â”œâ”€â”€ .docs/
â”‚   â””â”€â”€ design.md              # ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ cognito.ts             # Cognito API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â””â”€â”€ index.ts               # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ AuthGuard.svelte       # èªè¨¼ã‚¬ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ LoginButton.svelte     # ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³
â”‚   â”œâ”€â”€ LogoutButton.svelte    # ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³
â”‚   â”œâ”€â”€ UserMenu.svelte        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼
â”‚   â””â”€â”€ index.ts               # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ LoginPage.svelte       # ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ CallbackPage.svelte    # ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒšãƒ¼ã‚¸
â”‚   â””â”€â”€ index.ts               # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”œâ”€â”€ store/
â”‚   â”œâ”€â”€ auth.ts                # èªè¨¼ã‚¹ãƒˆã‚¢
â”‚   â”œâ”€â”€ pkce.ts                # PKCE ãƒ˜ãƒ«ãƒ‘ãƒ¼
â”‚   â””â”€â”€ index.ts               # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts               # å‹å®šç¾©
â””â”€â”€ index.ts                   # å…¬é–‹API
```

---

## å‹å®šç¾©

```typescript
// types/index.ts

/**
 * èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
 */
export interface AuthUser {
  readonly sub: string;           // Cognito User ID
  readonly email: string;
  readonly name?: string;
  readonly picture?: string;
  readonly emailVerified: boolean;
}

/**
 * èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³
 */
export interface AuthTokens {
  readonly accessToken: string;
  readonly idToken: string;
  readonly refreshToken?: string;
  readonly expiresAt: number;     // Unix timestamp (ms)
}

/**
 * èªè¨¼çŠ¶æ…‹
 */
export type AuthState =
  | { status: "loading" }
  | { status: "unauthenticated" }
  | { status: "authenticated"; user: AuthUser; tokens: AuthTokens };

/**
 * PKCE ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
 */
export interface PKCEParams {
  readonly codeVerifier: string;
  readonly codeChallenge: string;
  readonly state: string;
}

/**
 * Cognitoè¨­å®š
 */
export interface CognitoConfig {
  readonly userPoolId: string;
  readonly clientId: string;
  readonly domain: string;
  readonly redirectUri: string;
  readonly logoutUri: string;
  readonly scope: string[];
}

/**
 * èªè¨¼ã‚¨ãƒ©ãƒ¼
 */
export type AuthError =
  | { type: "INVALID_STATE"; message: string }
  | { type: "TOKEN_EXCHANGE_FAILED"; message: string }
  | { type: "TOKEN_REFRESH_FAILED"; message: string }
  | { type: "SESSION_EXPIRED"; message: string }
  | { type: "NETWORK_ERROR"; message: string }
  | { type: "UNKNOWN_ERROR"; message: string };
```

---

## ã‚¹ãƒˆã‚¢è¨­è¨ˆ

```typescript
// store/auth.ts

import { writable, derived, get } from "svelte/store";
import type { AuthState, AuthUser, AuthTokens, AuthError } from "../types";

// èªè¨¼çŠ¶æ…‹ã‚¹ãƒˆã‚¢
export const authState = writable<AuthState>({ status: "loading" });

// æ´¾ç”Ÿã‚¹ãƒˆã‚¢
export const isAuthenticated = derived(
  authState,
  ($state) => $state.status === "authenticated"
);

export const currentUser = derived(authState, ($state) =>
  $state.status === "authenticated" ? $state.user : null
);

export const isLoading = derived(
  authState,
  ($state) => $state.status === "loading"
);

// èªè¨¼ã‚¨ãƒ©ãƒ¼ã‚¹ãƒˆã‚¢
export const authError = writable<AuthError | null>(null);

// èªè¨¼ã‚¹ãƒˆã‚¢ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
export const authStore = {
  /**
   * ãƒ­ã‚°ã‚¤ãƒ³é–‹å§‹ï¼ˆCognito Hosted UIã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰
   */
  async login(): Promise<void> {
    // PKCE ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç”Ÿæˆ
    // state ã¨ code_verifier ã‚’ sessionStorage ã«ä¿å­˜
    // Cognito authorization endpoint ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  },

  /**
   * ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›ï¼‰
   */
  async handleCallback(code: string, state: string): Promise<void> {
    // state æ¤œè¨¼
    // code_verifier å–å¾—
    // ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ› API å‘¼ã³å‡ºã—
    // ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
    // èªè¨¼çŠ¶æ…‹æ›´æ–°
  },

  /**
   * ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
   */
  async logout(): Promise<void> {
    // ãƒ­ãƒ¼ã‚«ãƒ«ãƒˆãƒ¼ã‚¯ãƒ³å‰Šé™¤
    // Cognito logout endpoint ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  },

  /**
   * ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
   */
  async refreshToken(): Promise<void> {
    // refresh_token ã‚’ä½¿ç”¨ã—ã¦æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
    // ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°
  },

  /**
   * èªè¨¼çŠ¶æ…‹ã®åˆæœŸåŒ–ï¼ˆã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ï¼‰
   */
  async initialize(): Promise<void> {
    // localStorage ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
    // ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯
    // å¿…è¦ã«å¿œã˜ã¦ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
    // èªè¨¼çŠ¶æ…‹æ›´æ–°
  },
};
```

---

## PKCEå®Ÿè£…

```typescript
// store/pkce.ts

/**
 * ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ã‚’ç”Ÿæˆ
 */
function generateRandomString(length: number): string {
  const array = new Uint8Array(length);
  crypto.getRandomValues(array);
  return Array.from(array, (byte) =>
    byte.toString(16).padStart(2, "0")
  ).join("");
}

/**
 * code_verifier ã‚’ç”Ÿæˆï¼ˆ43-128æ–‡å­—ï¼‰
 */
export function generateCodeVerifier(): string {
  return generateRandomString(64);
}

/**
 * code_challenge ã‚’è¨ˆç®—ï¼ˆSHA-256ãƒãƒƒã‚·ãƒ¥ + Base64URLï¼‰
 */
export async function generateCodeChallenge(
  codeVerifier: string
): Promise<string> {
  const encoder = new TextEncoder();
  const data = encoder.encode(codeVerifier);
  const hash = await crypto.subtle.digest("SHA-256", data);

  return base64UrlEncode(hash);
}

/**
 * Base64URL ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
 */
function base64UrlEncode(buffer: ArrayBuffer): string {
  const bytes = new Uint8Array(buffer);
  let binary = "";
  for (const byte of bytes) {
    binary += String.fromCharCode(byte);
  }
  return btoa(binary)
    .replace(/\+/g, "-")
    .replace(/\//g, "_")
    .replace(/=+$/, "");
}

/**
 * state ã‚’ç”Ÿæˆ
 */
export function generateState(): string {
  return generateRandomString(32);
}

/**
 * PKCE ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
 */
export function storePKCEParams(codeVerifier: string, state: string): void {
  sessionStorage.setItem("pkce_code_verifier", codeVerifier);
  sessionStorage.setItem("pkce_state", state);
}

/**
 * PKCE ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å–å¾—ãƒ»å‰Šé™¤
 */
export function retrievePKCEParams(): {
  codeVerifier: string | null;
  state: string | null;
} {
  const codeVerifier = sessionStorage.getItem("pkce_code_verifier");
  const state = sessionStorage.getItem("pkce_state");

  // ä¸€åº¦ä½¿ç”¨ã—ãŸã‚‰å‰Šé™¤
  sessionStorage.removeItem("pkce_code_verifier");
  sessionStorage.removeItem("pkce_state");

  return { codeVerifier, state };
}
```

---

## ç’°å¢ƒå¤‰æ•°

```bash
# .env
VITE_COGNITO_USER_POOL_ID=ap-northeast-1_XXXXXXXXX
VITE_COGNITO_CLIENT_ID=xxxxxxxxxxxxxxxxxxxxxxxxxx
VITE_COGNITO_DOMAIN=your-domain.auth.ap-northeast-1.amazoncognito.com
VITE_COGNITO_REDIRECT_URI=http://localhost:5173/auth/callback
VITE_COGNITO_LOGOUT_URI=http://localhost:5173/login
```

---

## i18n ç¿»è¨³ã‚­ãƒ¼

```typescript
// lib/i18n/types.ts ã«è¿½åŠ 

auth: {
  login: string;
  logout: string;
  loggingIn: string;
  loggingOut: string;
  loginTitle: string;
  loginSubtitle: string;
  loginButton: string;
  logoutButton: string;
  welcomeBack: string;
  // Callback page
  processing: string;
  redirecting: string;
  // Errors
  loginFailed: string;
  sessionExpired: string;
  invalidSession: string;
  tryAgain: string;
  backToLogin: string;
  // User menu
  profile: string;
  settings: string;
};
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜

| ãƒˆãƒ¼ã‚¯ãƒ³ | ä¿å­˜å ´æ‰€ | ç†ç”± |
|----------|----------|------|
| Access Token | ãƒ¡ãƒ¢ãƒªï¼ˆSvelte storeï¼‰ | XSSæ”»æ’ƒãƒªã‚¹ã‚¯è»½æ¸› |
| ID Token | ãƒ¡ãƒ¢ãƒªï¼ˆSvelte storeï¼‰ | XSSæ”»æ’ƒãƒªã‚¹ã‚¯è»½æ¸› |
| Refresh Token | localStorageï¼ˆæš—å·åŒ–ï¼‰ | æ°¸ç¶šåŒ–å¿…è¦ |

### PKCE ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | ä¿å­˜å ´æ‰€ | æœ‰åŠ¹æœŸé–“ |
|------------|----------|----------|
| code_verifier | sessionStorage | èªè¨¼å®Œäº†ã¾ã§ |
| state | sessionStorage | èªè¨¼å®Œäº†ã¾ã§ |

### CORSè¨­å®š

- Cognito ãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã‚‰ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’è¨±å¯
- APIå´ã§é©åˆ‡ãªCORSè¨­å®š

---

## ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£

- ã™ã¹ã¦ã®ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã«é©åˆ‡ãªãƒ©ãƒ™ãƒ«
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯aria-liveã§é€šçŸ¥
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œ
- ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç®¡ç†ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«ã€ã‚¨ãƒ©ãƒ¼æ™‚ï¼‰

---

## ãƒ†ã‚¹ãƒˆè¨ˆç”»

### Unit Tests
- [ ] PKCE ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç”Ÿæˆãƒ†ã‚¹ãƒˆ
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
- [ ] èªè¨¼çŠ¶æ…‹é·ç§»ãƒ†ã‚¹ãƒˆ

### Integration Tests
- [ ] ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
- [ ] ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰

### E2E Tests
- [ ] å®Œå…¨ãªãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼
- [ ] ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ•ãƒ­ãƒ¼
- [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

---

## å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: åŸºç›¤
- [ ] å‹å®šç¾©ã®å®Ÿè£…
- [ ] PKCE ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®å®Ÿè£…
- [ ] èªè¨¼ã‚¹ãƒˆã‚¢ã®å®Ÿè£…
- [ ] ç’°å¢ƒå¤‰æ•°è¨­å®š

### Phase 2: ç”»é¢å®Ÿè£…
- [ ] ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã®å®Ÿè£…
- [ ] ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒšãƒ¼ã‚¸ã®å®Ÿè£…
- [ ] èªè¨¼ã‚¬ãƒ¼ãƒ‰ã®å®Ÿè£…

### Phase 3: UIçµ±åˆ
- [ ] ãƒ˜ãƒƒãƒ€ãƒ¼ã¸ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ 
- [ ] ã‚µã‚¤ãƒ‰ãƒãƒ¼ã¸ã®ãƒ­ã‚°ã‚¢ã‚¦ãƒˆè¿½åŠ 
- [ ] ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ›´æ–°

### Phase 4: å“è³ªä¿è¨¼
- [ ] i18n ç¿»è¨³è¿½åŠ 
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ç¢ºèª
- [ ] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ç¢ºèª
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼
